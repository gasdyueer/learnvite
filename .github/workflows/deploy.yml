# 构建 VitePress 站点并将其部署到 GitHub Pages 的示例工作流程
# (修复 'No such remote origin' 错误，确保正确添加远程仓库)
name: Deploy VitePress site to Pages (via git push with custom GH_TOKEN)

on:
  push:
    branches: [main]
  workflow_dispatch:

permissions:
  contents: read # 只需读取权限，因为我们使用自定义的 GH_TOKEN 进行推送

concurrency:
  group: pages
  cancel-in-progress: false

jobs:
  build-and-deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node
        uses: actions/setup-node@v4
        with:
          node-version: 22
          cache: npm

      - name: Install dependencies
        run: npm ci

      - name: Build with VitePress
        run: npm run docs:build

      - name: Configure Git User
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      - name: Deploy to GitHub Pages
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }} 
        run: |
          # 假设 VitePress 构建到 docs/.vitepress/dist
          cd docs/.vitepress/dist

          git init # 初始化一个新的本地 Git 仓库
          git add -A
          git commit -m "Deploy VitePress site via GitHub Actions"
          
          # --- 核心修复：先添加远程仓库，再进行推送 ---
          # 注意：请将 gasdyueer/learnvite.git 替换为 ${{ github.repository }}.git
          # 这是 Copilot 提供的具体仓库名称，但使用 ${{ github.repository }} 更通用
          git remote add origin https://${{ secrets.GH_TOKEN }}@github.com/${{ github.repository }}.git
          
          # 推送到 gh-pages 分支，强制覆盖
          git push origin HEAD:gh-pages --force
          # --- 核心修复结束 ---

# 重要的注意事项：
# 1. 您必须在 GitHub 仓库的 Settings -> Secrets and variables -> Actions -> Repository secrets 中
#    创建一个名为 `GH_TOKEN` 的 secret，其值是您的 Personal Access Token (PAT)。
# 2. 该 PAT 必须具有足够的权限来推送到您的仓库（通常是 `repo` 作用域）。
# 3. 在您的仓库设置中，请确保 GitHub Pages 的源已设置为 `gh-pages` 分支。
